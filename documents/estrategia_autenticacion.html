<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estrategia de Autenticación y Seguridad (API Key)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); }
        h2 { border-bottom: 2px solid #fecaca; padding-bottom: 0.5rem; }
        th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #f3f4f6; }
        th { background-color: #fef2f2; font-weight: 600; }
        pre { background-color: #27272a; color: #f4f4f5; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="max-w-3xl mx-auto bg-white p-6 sm:p-10 rounded-xl card">
        <header class="mb-8 border-b pb-4">
            <h1 class="text-3xl font-bold text-gray-900 flex items-center mb-1">
                <i data-lucide="shield-check" class="w-6 h-6 mr-3 text-red-600"></i>
                Estrategia de Autenticación y Seguridad (API Key)
            </h1>
            <p class="text-gray-500">Detalle del mecanismo de seguridad para la comunicación sincrónica entre microservicios.</p>
        </header>

        <nav class="mb-8 p-4 bg-red-50 rounded-lg text-sm">
            <h3 class="font-semibold text-red-700 mb-2">Contenidos</h3>
            <ul class="list-none space-y-1">
                <li><a href="#mecanismo" class="hover:text-red-600">1. Mecanismo de Autenticación</a></li>
                <li><a href="#flujo" class="hover:text-red-600">2. Flujo de Comunicación y Verificación</a></li>
                <li><a href="#errores" class="hover:text-red-600">3. Códigos de Error Asociados</a></li>
            </ul>
        </nav>

        <section id="mecanismo" class="mb-8">
            <h2 class="text-2xl font-semibold text-red-800 mb-4">1. Mecanismo de Autenticación</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr><th>Aspecto</th><th>Descripción</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>**Tipo de Autenticación**</td><td>API Key (Precompartida, estática).</td></tr>
                        <tr><td>**Ubicación de la Clave**</td><td>**HTTP Header: <code>X-API-Key</code>**.</td></tr>
                        <tr><td>**Almacenamiento**</td><td>Claves en el archivo <code>.env</code>, inyectadas como variables de entorno al contenedor (nunca en código fuente).</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="flujo" class="mb-8">
            <h2 class="text-2xl font-semibold text-red-800 mb-4">2. Flujo de Comunicación y Verificación</h2>
            
            <h3 class="text-xl font-semibold mt-4 mb-2 text-gray-700">A. Inventory Service (Emisor/Cliente)</h3>
            <p class="text-gray-700 ml-4">**Responsabilidad:** Incluir el encabezado <code>X-API-Key</code> con la clave secreta (<code>PRODUCTS_API_KEY</code>) en cada solicitud dirigida al *products-service*.</p>
            
            <h3 class="text-xl font-semibold mt-6 mb-2 text-gray-700">B. Products Service (Receptor/Servidor)</h3>
            <ul class="list-decimal list-inside ml-4 space-y-2 text-gray-700">
                <li>**Implementación:** Se utiliza el Middleware (<code>auth_api_key.js</code>).</li>
                <li>Verifica si el encabezado <code>X-API-Key</code> está presente.</li>
                <li>Compara el valor del encabezado con el valor esperado (<code>PRODUCTS_API_KEY</code>).</li>
                <li>Si la clave es válida, permite el paso a la lógica.</li>
                <li>Si es inválida o faltante, **responde inmediatamente con un error 401 Unauthorized**.</li>
            </ul>
        </section>

        <section id="errores" class="mb-8">
            <h2 class="text-2xl font-semibold text-red-800 mb-4">3. Códigos de Error Asociados</h2>
            <p class="text-gray-700 mb-2">Cualquier fallo de autenticación debe adherirse estrictamente al formato **JSON API**:</p>
            <pre><code>{
  "errors": [
    {
      "status": "401",
      "code": "UNAUTHORIZED_ACCESS",
      "title": "Acceso No Autorizado",
      "detail": "La API Key proporcionada es incorrecta o falta el header X-API-Key."
    }
  ]
}</code></pre>
            <ul class="list-disc list-inside ml-4 mt-2 text-gray-700">
                <li>**Código HTTP:** <code>401 Unauthorized</code>.</li>
                <li>**Código Interno:** <code>UNAUTHORIZED_ACCESS</code>.</li>
            </ul>
        </section>
    </div>
    <script>lucide.createIcons();</script>
</body>
</html>